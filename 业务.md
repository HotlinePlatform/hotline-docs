业务简介：访客通过微信小程序进入热线平台，选择当天值班的咨询师并发起咨询会话，咨询过程中如果咨询师有解决不了的问题，咨询师可以求助自己绑定的值班督导，值班督导在线给咨询师提供咨询指导。咨询结束后，访客、咨询师和督导可以通过平台各自的客户端查看自己的咨询历史记录。

业务角色：访客、咨询师、督导、系统管理员

业务平台：微信小程序

业务流程：在这里，我们分角色、分步骤来详细介绍整个平台的使用流程：

角色一：访客

角色动作：进行咨询

角色目的：获取心理咨询

操作流程：登录/注册 - 开始咨询 - 选择咨询师  - 进行咨询 - 咨询结束

- 登录/注册：我们以用户的手机号码作为唯一凭证进行身份区分。当进入系统时，自动进入微信快捷登录页面，微信登录后检测该微信号是否绑定过手机号，如果未绑定过，说明是第一次进入系统，进入注册流程，需要用户输入手机号并进行验证码验证，并填写紧急联系人和紧急联系电话，验证手机号成功后获得用户账户，之后再通过该微信进入系统，会自动获取该账户，不需要再次验证码注册。

![1](https://github.com/HotlinePlatform/hotline-docs/blob/2129d203306ad52d3751ee55099f4b56f7efdb1e/image/SDS.png)

- 开始咨询：用户登录后，展示当前在线的咨询师和其状态（或咨询历史记录等相关信息），并提供“立即在线咨询”按钮。用户点击后展示知情同意书，该页面默认停留5秒，5秒后可以点击同意并进入咨询师列表。
- 选择咨询师：咨询师列表会展示所有当天排班且后台登录在线的咨询师列表，咨询师列表页面会显示每个咨询师的姓名、综合评分、当前状态以及是否有过自己的咨询记录，用户点击咨询师后即选择完毕，若该咨询师目前空闲，则直接开始咨询；若该咨询师目前忙碌，则进入该咨询师的等待队列，前面的访客咨询结束后开始咨询。
- 进行咨询：访客进入咨询界面，咨询会话会进行实时时长统计，十分钟为双方都未发消息所能维持的最长会话时长，我们称双方都未发消息但还在对话中的时间为空白期，当空白期达到九分钟时，会弹出交互式弹窗或文字提示（具体形式见最终实现），此时若访客与界面有交互（按钮交互或发送消息），则空白期将重新计算。访客可以在该页面发送文字、图片、语音、表情、咨询历史。在咨询过程中，访客可以随时主动结束咨询。

![2](https://github.com/HotlinePlatform/hotline-docs/blob/2129d203306ad52d3751ee55099f4b56f7efdb1e/image/%E9%80%89%E6%8B%A9%E5%92%A8%E8%AF%A2%E5%B8%88.png)

- 咨询结束：咨询结束后，系统默认推送一条评价消息给访客，访客可以对咨询师进行星级评价。这次的咨询历史会记录到用户的咨询历史，可在首页相应模块查看。

角色二：咨询师

角色动作：查看首页上各种数据、查询咨询记录、接收咨询、请求督导、访客评价

角色目的：完成咨询工作

操作细节：

- 查看首页上各种数据：我的综合评价、我的状态、累计完成咨询、今日咨询数、今日咨询时长、当前会话数、值班表、最近完成的咨询、历史咨询时长统计等数据。
- 查询咨询记录：咨询记录列表分页展示咨询人、咨询时长、咨询日期、咨询评级、咨询评价几个信息，且可以对列表进行针对姓名和日期的搜索。
- 接收咨询：当有人向该咨询师发起咨询时（或等待队列队头为这位访客时），该访客的会话会出现在咨询师的会话列表。咨询师点击会话进入该咨询页面进行回应。在咨询过程中，咨询师可以发送语音、图片、表情和文字消息，可以手动结束咨询会话。
- 请求督导：咨询过程中若出现了自己力所不能及的事情，则可以点击会话框中的“求助督导”向自己的督导求助，求助督导时系统只能返回和这个咨询师有绑定关系且在线的督导，开启求助之后，咨询师可以同时和督导及访客进行会话，且咨询师和访客的聊天记录会默认实时同步给督导。
- 访客评价：结束（手动结束或超时结束）咨询之后，咨询师对访客进行评价

角色三：督导

角色动作：响应咨询、查看咨询师相关数据、响应咨询师求助

角色目的：帮助咨询师完成工作

操作细节：

- 响应咨询：与咨询师类似
- 查看咨询师相关数据：督导除了查看自己的咨询/求助统计数据之外，还可以查看与自己有绑定关系的咨询师的在线状态及咨询会话统计数据，以及其咨询记录，直到绑定关系解除
- 响应咨询师求助：督导响应咨询师求助后，可以和咨询师进行实时聊天沟通，同时也可以实时接收到咨询师和访客的聊天记录。

角色四：机构管理员

角色动作：查看所有督导/咨询师的数据、排班、咨询师管理、督导管理、访客管理

操作细节：

- 查看所有督导/咨询师的数据：包括今日总咨询数、时长、在线咨询师、咨询数量排行、所有咨询记录等等
- 排班：给咨询师和督导进行排班
- 咨询师管理：可以增加、删除、修改、查询咨询师账号数据
- 督导管理：可以增加、删除、修改、查询督导账号数据，同时修改咨询师的督导绑定关系及默认值班时间，其中一个咨询师可以绑定多个督导
- 访客管理：机构管理员可以对访客进行禁用操作，禁用后，访客将不能再进入小程序进行咨询



业务说明：

1. 访客注册及信息修改：

   - 只能通过微信小程序注册，一个微信小程序账号只能注册一次；
   - 用户姓名允许重复，可为中英文，长度限制为2~32个字符，不能包含特殊字符：\;!@#$%^&**()
   - 联系电话必须填写通过短信验证或者获取微信认证的手机号码，一个手机号码只能注册一次；
   - 紧急联系人姓名允许重复，可为中英文，长度限制为2~32个字符，不能包含特殊字符：\;!@#$%^&**()
   - 紧急联系人电话必须填写11位符合手机号正则校验的手机号码
   - 用户注册及用户修改个人信息时对字段的约束规则保持一致

2. 访客开始咨询：

   - 访客注册完成后才能进行咨询；
   - 咨询开始时，必须阅读并同意“知情同意书”；
   - “知情同意书”页面默认停留5秒，5秒只能才能点击同意，未点击同意之前不能进入咨询；
   - 进入咨询师列表页面，显示的是所有当天排班且后台登录在线的咨询师列表；
   - 咨询师列表页面会显示每个咨询师的姓名、综合评分、当前状态以及是否有过自己的咨询记录。

3. 访客咨询过程中：

   - 咨询开始后，系统会进行会话实时计时；
   - 访客和咨询师可以发文字、语音、图片和表情消息；
   - 默认咨询师不能查看访客的历史咨询记录，除非访客主动将自己的历史记录发送给咨询师后咨询师才能看到，并且只能看到访客选择性发送的那些咨询会话记录；
   - 咨询过程中，访客可以随时主动结束咨询会话；
   - 如咨询会话超过10分钟没有产生新的消息，系统会先发送一条确认结束咨询的提示，如访客超过5分钟还没有输入反馈，则系统将自动结束本次咨询会话；
   - 咨询会话结束后，系统默认推送一条评价消息给访客，访客可以对咨询师进行星级评价；

4. 咨询师首页：

   - 累计完成咨询：该咨询师所有咨询会话总时长，计量单位是分钟；
   - 今日咨询数：值班当日的咨询会话总数，如果同一个访客上午下午各咨询了一次，则会话数为2；
   - 今日咨询时长：值班当日的所有咨询会话总时长，计量单位是分钟；
   - 当前会话总数：当前正在聊天咨询的会话数量；

5. 咨询记录查询：

   - 咨询记录页面只能查看自己咨询的会话记录；

   - 支持咨询会话记录导出，只能导出文字类聊天记录，非文字类记录显示消息发送时间及请前往系统查看的默认文字提示；

   - 支持批量导出所有咨询会话的记录，多个咨询记录以zip包形式打包后导出；

6. 咨询师开始咨询：

   - 当访客发起咨询时，系统会默认在咨询师页面的左侧边栏显示新的咨询会话以及未读的消息数量；
   - 咨询师点击左侧会话进入该咨询页面进行咨询；
   - 咨询过程中，咨询师可以发送语音、图片、表情和文字消息；
   - 咨询师可以手动结束咨询会话；
   - 咨询过程中，咨询师可以点击“求助督导”向自己的督导求助，求助督导时系统只能返回和这个咨询师有绑定关系且在线的督导；
   - 开始求助后，咨询师和访客的聊天记录会默认实时同步给督导

7. 添加/修改咨询师：

   - . 添加咨询师包括个人信息及工作信息两部分，必须都填写完成后才能添加成功；
   - 用户姓名允许重复，可为中英文，长度限制为2~32个字符，不能包含特殊字符：\;!@#$%^&**()
   - 年龄只能输入整数数字；
   - 身份证号码：必须满足身份证正则规则校验；
   - 电话：必须满足11位电话号码正则规则校验；
   - 邮箱：必须满足邮箱正则规则校验；
   - 绑定督导时，可以选择一到多位督导；
   - 用户名：咨询师用来登录系统的账号名，只允许输入英文和下划线
   - 密码：不低于6位字符

8. 添加/修改督导：

   - 添加修改督导账号时，也包括个人信息和工作信息两部分，其中个人信息相关字段规划和咨询师的一致；
   - 所有字段都为必填项，所有字段输入内容都不能包含特殊字符：\;!@#$%^&**() ；
   - 督导必须选择一个督导咨询并输入资质编号；



| 角色名称   | 职责描述                                                     |
| ---------- | ------------------------------------------------------------ |
| 访客       | 登录平台，选择合适的咨询师，进行咨询，对咨询师进行评价；查看自己的咨询数据和咨询历史 |
| 咨询师     | 查看首页上各种数据、查询咨询记录、接收咨询、请求督导、访客评价 |
| 督导       | 响应咨询、查看咨询师相关数据、响应咨询师求助                 |
| 机构管理员 | 查看所有督导/咨询师的数据、排班、咨询师管理、督导管理、访客管理 |



### 领域模型图

![领域模型](https://github.com/HotlinePlatform/hotline-docs/blob/828b239bf6af4cd790e7163eac7c99cb4651014a/image/%E9%A2%86%E5%9F%9F%E6%A8%A1%E5%9E%8B.png?raw=true)

### 主要业务逻辑图

![活动图](https://github.com/HotlinePlatform/hotline-docs/blob/b3a4747389575fba7d3ddea8bdf6eec03ecdec54/image/%E6%B4%BB%E5%8A%A8%E5%9B%BE.jpg)
